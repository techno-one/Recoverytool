<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recovery Tool</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f3f7; margin:0; }
    header { background:#2c3e50; color:#fff; padding:15px; text-align:center; font-size:1.5em; font-weight:bold; }
    main { padding:20px; max-width:800px; margin:auto; }
    .card { background:#fff; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
    button {
      background:#3498db; border:none; color:#fff; padding:8px 16px;
      border-radius:6px; cursor:pointer; font-size:14px;
    }
    button:disabled { background:#95a5a6; cursor:not-allowed; }
    .progress { width:100%; background:#ddd; border-radius:6px; overflow:hidden; margin:10px 0; height:20px; }
    .progress-bar { height:100%; width:0; background:#27ae60; transition:width 0.3s; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { padding:8px 12px; border-bottom:1px solid #ddd; text-align:left; }
    th { background:#f9fafc; }
    .status-ok { color:green; font-weight:bold; }
    .status-fail { color:red; font-weight:bold; }
    input[type=password] {
      width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc;
    }
    .success { color:green; font-weight:bold; margin-top:10px; }
    .error { color:red; font-weight:bold; margin-top:10px; }
    #countdown { font-weight:bold; color:#e67e22; margin-top:10px; }
  </style>
</head>
<body>
  <header>üîç File Recovery Tool By TechnoAspire</header>
  <main>
    <div class="card">
      <h2>Step 1: Select Location Address File</h2>
      <input type="file" id="imageFile">
      <button id="scanBtn">Scan</button>
      <div class="progress" style="display:none;">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <div class="card" id="resultsCard" style="display:none;">
      <h2>Step 2: Scan Results</h2>
      <table>
        <thead>
          <tr>
            <th>Offset</th>
            <th>Type</th>
            <th>Status</th>
            <th>Recover</th>
          </tr>
        </thead>
        <tbody id="resultsTable"></tbody>
      </table>
    </div>

    <div class="card" id="keyCard" style="display:none;">
      <h2>Step 3: Enter Recovery Key</h2>
      <input type="password" id="keyInput" placeholder="Enter recovery key">
      <button id="unlockBtn">Unlock</button>
      <div id="message"></div>
      <div id="countdown"></div>
    </div>

    <!-- Download message container -->
    <div id="downloadContainer"></div>
  </main>

  <script>
  
    const correctHash = "80e8aaa62606654115dd29a1b7cd36587343d1d4a2b4f7303ac2bc97dec1f356";

    let selectedFileType = null;

    // wait time = 1 minute
    const WAIT_MINUTES = 1;
    const WAIT_MS = WAIT_MINUTES * 60 * 1000;

    const scanBtn = document.getElementById("scanBtn");
    const progress = document.querySelector(".progress");
    const progressBar = document.getElementById("progressBar");
    const resultsCard = document.getElementById("resultsCard");
    const resultsTable = document.getElementById("resultsTable");
    const keyCard = document.getElementById("keyCard");
    const keyInput = document.getElementById("keyInput");
    const unlockBtn = document.getElementById("unlockBtn");
    const message = document.getElementById("message");
    const countdownEl = document.getElementById("countdown");
    const downloadContainer = document.getElementById("downloadContainer");

    // Hashing function (SHA-256 ‚Üí hex string)
    async function hashKey(input) {
      const encoder = new TextEncoder();
      const data = encoder.encode(input);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // scan process
    scanBtn.addEventListener("click", () => {
      if (!document.getElementById("imageFile").files.length) {
        alert("Select Any 1 Location File.");
        return;
      }

      progress.style.display = "block";
      progressBar.style.width = "0%";
      resultsCard.style.display = "none";
      keyCard.style.display = "none";
      resultsTable.innerHTML = "";
      let percent = 0;

      const interval = setInterval(() => {
        percent += 0.005;
        progressBar.style.width = percent + "%";
        if (percent >= 100) {
          clearInterval(interval);
          showResults();
        }
      }, 100);
    });

    // scan results
    function showResults() {
      resultsCard.style.display = "block";
      const files = [
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
        { offset: "POLISH SLIP 15-11-2024 TO CON.......", type: "DOC", status: "ok" },
      ];
      resultsTable.innerHTML = "";
      files.forEach(file => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${file.offset}</td>
          <td>${file.type}</td>
          <td class="status-${file.status}">${file.status}</td>
          <td>
            <button ${file.status !== "ok" ? "disabled" : ""} 
              onclick="recoverFile('${file.type}')">Recover</button>
          </td>
        `;
        resultsTable.appendChild(row);
      });
    }

    // User clicks Recover
    window.recoverFile = function(type) {
      selectedFileType = type;
      keyCard.style.display = "block";
      message.innerHTML = "";
      keyInput.value = "";
    }

    // Unlock with key (hashed)
    unlockBtn.addEventListener("click", async () => {
      const enteredKey = keyInput.value.trim();
      const enteredHash = await hashKey(enteredKey);

      if (enteredHash === correctHash) {
        const unlockTime = Date.now() + WAIT_MS;
        localStorage.setItem("unlockTime", unlockTime);
        localStorage.removeItem("fileDownloaded");
        startCountdown(unlockTime);
        message.innerHTML = `<div class='success'>‚úÖ Key accepted. Please wait ${WAIT_MINUTES} minute...</div>`;
      } else {
        message.innerHTML = "<div class='error'>‚ùå Invalid key</div>";
      }
      keyInput.value = "";
    });

    // Countdown function
    function startCountdown(endTime) {
      function update() {
        const now = Date.now();
        const remaining = endTime - now;
        if (remaining <= 0) {
          countdownEl.innerHTML = "‚è≥ Time complete!";
          clearInterval(timer);

          if (!localStorage.getItem("fileDownloaded")) {
            triggerAutoDownload();
            localStorage.setItem("fileDownloaded", "yes");
            keyCard.style.display = "none";
          }
        } else {
          const mins = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
          const secs = Math.floor((remaining % (1000 * 60)) / 1000);
          countdownEl.innerHTML = `‚è≥ Please wait: ${mins}m ${secs}s`;
        }
      }
      update();
      const timer = setInterval(update, 1000);
    }

    // Auto download file after countdown
    function triggerAutoDownload() {
      downloadContainer.innerHTML = `
        <div class="card">
          <h2>üìÇ Your file is being downloaded...</h2>
        </div>
      `;
      const link = document.createElement("a");
      link.href = "1.xlsx";   // ensure this file exists in same folder
      link.download = "RecoveredSheet.xlsx";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // On page load, check if countdown already started
    window.onload = function() {
      const unlockTime = localStorage.getItem("unlockTime");
      const downloaded = localStorage.getItem("fileDownloaded");
      if (unlockTime && !downloaded) {
        startCountdown(parseInt(unlockTime));
        keyCard.style.display = "block";
        message.innerHTML = "<div class='success'>‚úÖ Key already entered earlier</div>";
      }
    }
  </script>
</body>
</html>
